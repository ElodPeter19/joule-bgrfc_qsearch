parameters:
  - name: inbound_destination
    optional: true

action_groups:
  - actions:
      - type: api-request
        method: GET
        system_alias: IBP_QSEARCH
        path: /sap/opu/odata4/ibp/a_bgrfcq_search/srvd_a2x/ibp/c_bgrfcq_search_srv/0001/xIBPxI_bgrfcqueue_srch
        headers :
          Accept: application/json
          $filter: destination eq '<? inbound_destination ?>'
        result_variable: inbound_destinations
      - type: message
        message:
          type: text
          content: |
            Distinct inbound destinations and their counts:
            ${
              inbound_destinations.d.results
                .groupBy(r -> r.destination )
                .entrySet()
                .stream()
                .map(e -> e.getKey() + ': ' + e.getValue().size())
                .collect(joining('\n'))
            }